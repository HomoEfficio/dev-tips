# ElasticSearch Primer

[엘라스틱 스택 개발부터 운영까지](http://www.yes24.com/product/goods/103030516)를 참고해서 추려내고 의견을 살짝 가미한 아주아주 기본적인 일래스틱서치 관련 정보



## 기본 개념

- 캐릭터 필터, 토크나이저, 토큰 필터로 구성된 분석기(analyzer)를 통해 데이터를 분해하고 역인덱스를 만들어서 단어별로 전문 검색



## 용어

### Mapping

- RDBMS의 스키마와 개념적으로 유사
- RDBMS의 스키마는 자동으로 변경이 발생하지 않지만 일래스틱서치의 매핑은 데이터 타입 자동 변경, 필드 자동 추가 등 자동 변경(Dynamic Mapping)이 발생한다

### Index

- RDBMS의 테이블과 개념적으로 비슷한 레벨/단위
  - 인덱스는 RDBMS뿐 아니라 대부분의 NoSQL에서도 이미 '색인'의 의미로 널리 쓰이고 있는데 왜 굳이 테이블과 비슷한 레벨/단위에 인덱스라는 이름을 쓰는 만행을 저질렀을까..
  - 일래스틱서치의 '인덱스'는 일반적으로 통용되는 인덱스와 다르지만 일래스틱서치의 '역인덱스'는 일반적으로 통용되는 역인덱스와 같다(이게 뭐냐고..)
- 여러 개의 도큐먼트를 가질 수 있다

### Document

- RDBMS의 레코드와 개념적으로 비슷한 레벨/단위
- 여러 개의 필드를 가질 수 있다

### Field

- RDBMS의 컬럼과 개념적으로 비슷한 레벨/단위

### text 타입

- 일반적으로 문장이나 여러 단어로 된 문자열을 저장하는 타입
- 문자열에 포함된 텍스트가 분석기를 통해 여러개의 토큰으로 분해되고 최종적으로 여러개의 term이 돼서 역인덱스에 저장된다
- 전문 검색이 필요한 문자열 필드는 text 타입으로 지정해야한다

### keyword 타입

- 문자열 전체가 분석기를 거치지 않고 하나의 term으로 역인덱스에 저장된다
- 전문 검색이 필요하지 않은 범주형 데이터(쉽게 생각하면 enum)에 적합

### Indexing

- RDBMS뿐 아니라 대부분의 NoSQL에서 일반적으로 의미하는 '색인'을 만드는.. 게 아니라 도큐먼트를 인덱스에 추가하는 것을 의미

### Token

- 토크나이저를 거쳐서 나온 중간 결과물이며 토큰 필터의 입력으로 사용된다

### Term

- 토큰 필터를 거쳐서 나온 최종 결과물이며 역인덱스에 저장되고 검색에 사용된다



## 특징

### 수정/삭제 비용이 크다

- 도큐먼트 수정이나 삭제 비용이 매우 비싸므로 수정/삭제가 빈번한 곳에 일래스틱서치를 사용하는 것은 부적합
  - 역인덱스를 사용한다면 도큐먼트에 포함된 단어 하나하나에 대한 역인덱스를 모두 찾아 수정/삭제해야하므로 수정/삭제 비용이 삐쌀 수 밖에 없다
  - 수정/삭제가 빈번한 상황에서 전문 검색도 필요하다면 일래스틱서치와 다른 DB를 함께 사용하기도 한다
    - 일래스틱서치의 전문 검색을 통해 다른 DB에 저장된 데이터의 식별자를 찾아내고, 수정/삭제가 빈번한 실제 데이터는 일래스틱서처에서 찾은 식별자를 활용해서 다른 DB에서 조회
    - 이 경우 일래스틱서치와 다른 DB의 동기화를 잘 맞춰야 함


### Multi Field

- 하나의 필드를 여러 용도로 사용될 수 있게 해준다
  - a라는 필드에 z, y, x, ... 라는 하위 필드를 두고, a필드의 값 aa에 z, y, x, ... 별로 다른 타입을 사용할 수 있다
  - 아래와 같이 멀티필드 매핑을 지정하고 인덱스를 생성하면, a필드에 저장된 'hello elasticsearch multi field'라는 문자열을 `a`로 참조하면 text 타입으로 사용할 수 있고, `a.z`로 참조하면 keyword 타입으로도 사용할 수 있다.
    ```json
    POST example_multi_field_index
    {
      "mappings": {
        "properties": {
          "a": {
            "type": "text",
            "fields": {
              "z": { "type": "keyword" }
            }
          }
        }
      }
    }
    ```





